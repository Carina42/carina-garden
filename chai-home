<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æŸ´çªä¹‹å®¶ï½œä¸»é¡µæ€»è§ˆ</title>
  <style>
    :root {
      --bg-light: #f9fdfb;
      --bg-dark: #2f2f2f;
      --main-color: #a6c8af;
      --font-color: #333;
    }
    body {
      font-family: 'Hiragino Sans GB', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-light);
      color: var(--font-color);
      transition: background-color 0.5s ease, color 0.5s ease;
    }
    .dark {
      background-color: var(--bg-dark);
      color: white;
    }
    header {
      background-color: var(--main-color);
      padding: 1.2rem;
      text-align: center;
      font-size: 1.8rem;
      color: white;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1.2rem;
      padding: 2rem;
    }
    .card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 1.2rem;
      width: 260px;
      transition: transform 0.2s ease;
      text-align: center;
    }
    .card:hover {
      transform: scale(1.02);
    }
    .dark .card {
      background: #444;
      color: white;
    }
    .quote, .countdown, .weather, .write-status {
      text-align: center;
      margin-top: 1rem;
    }
    .toggle-theme {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: none;
      border: 1px solid var(--main-color);
      border-radius: 6px;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>ğŸª´ æŸ´çªä¹‹å®¶ Â· ç”Ÿæ´»æ€»è§ˆ</header>

  <div class="grid">
    <div class="card">
      <h3>ğŸ“– é˜…è¯»è¿›åº¦</h3>
      <p>ä½ å·²é˜…è¯» <span id="readCount">0</span> æœ¬ä¹¦</p>
      <p>å·²å¼€èŠ± <span id="flowers">0</span> æœµ ğŸŒ¸</p>
      <a href="reading.html">è¿›å…¥ä¹¦æ¶é¡µ</a>
    </div>

    <div class="card">
      <h3>ğŸƒâ€â™€ï¸ è¿åŠ¨è®°å½•</h3>
      <p>æœ¬å‘¨è¿åŠ¨ <b>3</b> æ¬¡</p>
      <p>ä¸Šæ¬¡ï¼šè§‚é¸Ÿ Â· åŒ—é¾™æ¹–</p>
    </div>

    <div class="card">
      <h3>ğŸ˜´ ç¡çœ çŠ¶å†µ</h3>
      <p>æ˜¨æ™šå…¥ç¡ï¼š23:20ï½œä»Šæ™¨èµ·ï¼š7:30</p>
      <p>æœ¬å‘¨å¹³å‡ï¼š7.2h</p>
    </div>

    <div class="card write-status">
      <h3>âœï¸ å†™ä½œè¿½è¸ª</h3>
      <p>æœ¬æœˆå†™ä½œå­—æ•°ï¼š<span id="words">0</span> å­—</p>
      <p>ä»Šæ—¥çŠ¶æ€ï¼š<span id="writeToday">æœªå¼€å§‹</span></p>
      <p><i id="writingMsg">åŠ æ²¹ï¼Œçµæ„Ÿåœ¨ç­‰ä½ ï¼</i></p>
    </div>

    <div class="card countdown">
      <h3>ğŸ“† å€’è®¡æ—¶</h3>
      <p>ä»Šå¹´è¿˜å‰© <span id="daysLeft"></span> å¤©</p>
      <p>ğŸ“ å»æ­å·æ—…è¡Œè¿˜æœ‰ <span id="customDays"></span> å¤©</p>
    </div>

    <div class="card weather">
      <h3>ğŸŒ¤ å½“å‰å¤©æ°”</h3>
      <p id="weatherDesc">è·å–ä¸­â€¦</p>
      <p id="temperature"></p>
    </div>

    <div class="card quote">
      <h3>ğŸ“œ ä»Šæ—¥è¯­å½•</h3>
      <p id="quote"></p>
    </div>
  </div>

  <button class="toggle-theme" onclick="toggleTheme()">ğŸŒ“ åˆ‡æ¢æ—¥å¤œæ¨¡å¼</button>

  <script>
    const quotes = [
      "The flower bloomed and faded. The sun rose and sank.",
      "A woman must have money and a room of her own if she is to write fiction.",
      "Books are the mirrors of the soul.",
      "I am rooted, but I flow.",
      "The past only comes back when the present runs so smoothly that it is like the sliding surface of a deep river."
    ];
    document.getElementById("quote").textContent = quotes[Math.floor(Math.random() * quotes.length)];

    const count = parseInt(localStorage.getItem("bookCount")) || 0;
    const words = parseInt(localStorage.getItem("wordCount")) || 0;
    const wroteToday = localStorage.getItem("wroteToday") || "false";
    document.getElementById("readCount").textContent = count;
    document.getElementById("flowers").textContent = Math.floor(count / 10);
    document.getElementById("words").textContent = words;
    document.getElementById("writeToday").textContent = wroteToday === "true" ? "å·²å†™" : "æœªå¼€å§‹";
    document.getElementById("writingMsg").textContent = wroteToday === "true" ? "å¤ªæ£’äº†ï¼ä½ æ­£åœ¨æ»‹å…»çµé­‚ âœ¨" : "åŠ æ²¹ï¼Œçµæ„Ÿåœ¨ç­‰ä½ ï¼";

    const today = new Date();
    const yearEnd = new Date(today.getFullYear(), 11, 31);
    const hangzhouTrip = new Date(today.getFullYear(), 4, 16); // 5æœˆ16æ—¥
    const oneDay = 24 * 60 * 60 * 1000;
    document.getElementById("daysLeft").textContent = Math.ceil((yearEnd - today) / oneDay);
    document.getElementById("customDays").textContent = Math.ceil((hangzhouTrip - today) / oneDay);

    function toggleTheme() {
      document.body.classList.toggle("dark");
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&timezone=auto`)
          .then(res => res.json())
          .then(data => {
            const code = data.current.weather_code;
            const temp = data.current.temperature_2m;
            let desc = "æ™´å¤© â˜€ï¸";
            if (code >= 51 && code <= 67) desc = "å°é›¨ ğŸŒ§ï¸";
            else if (code >= 1 && code <= 3) desc = "å¤šäº‘ â˜ï¸";
            else if (code >= 71 && code <= 77) desc = "ä¸‹é›ª â„ï¸";
            document.getElementById("weatherDesc").textContent = desc;
            document.getElementById("temperature").textContent = temp + "Â°C";
          });
      });
    }
  </script>
</body>
</html>
