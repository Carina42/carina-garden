
:root{
  --bg: #f7f5f2;
  --panel: rgba(255, 254, 252, 0.86);
  --ink: #2f2f2f;
  --muted: #6b6b6b;

  /* plant-morandi default */
  --accent: #6f8f72;        /* leaf */
  --accent2: #b8c5b1;       /* sage */
  --accent3: #d8d2c9;       /* paper */
  --line: rgba(64, 74, 60, .18);
  --shadow: 0 10px 26px rgba(30, 30, 30, .08);
  --radius: 18px;

  --borderOpacity: .18;
  --borderGlow: rgba(111, 143, 114, .25);
}

body.theme-sun{
  --bg: #fbf7ee;
  --panel: rgba(255, 252, 244, 0.88);
  --ink: #2d2a26;
  --muted: #6a5d4f;
  --accent: #c49a4b;      /* warm sun */
  --accent2: #d8c39f;
  --accent3: #efe7d7;
  --line: rgba(120, 90, 50, .16);
  --borderGlow: rgba(196, 154, 75, .22);
}

body.theme-moss{
  --bg: #f3f6f3;
  --panel: rgba(251, 253, 251, 0.88);
  --ink: #273028;
  --muted: #667168;
  --accent: #4f7b65;     /* moss */
  --accent2: #a8c2b1;
  --accent3: #d7e0d8;
  --line: rgba(79, 123, 101, .18);
  --borderGlow: rgba(79, 123, 101, .22);
}

body.theme-night{
  --bg: #141515;
  --panel: rgba(25, 26, 25, 0.74);
  --ink: #f2efe9;
  --muted: #c7c2b9;
  --accent: #8aa0a6;     /* moon-sage */
  --accent2: #4f5f62;
  --accent3: #2a2b2a;
  --line: rgba(220, 220, 220, .14);
  --borderGlow: rgba(138, 160, 166, .25);
  --shadow: 0 12px 30px rgba(0,0,0,.45);
  --borderOpacity: .10;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-rounded, system-ui, -apple-system, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
  background: radial-gradient(1200px 600px at 20% 0%, rgba(255,255,255,.42), transparent 60%),
              radial-gradient(900px 520px at 90% 20%, rgba(255,255,255,.28), transparent 55%),
              var(--bg);
  color: var(--ink);
}

/* ---------- Layout ---------- */
.shell{
  min-height:100%;
  display:flex;
  justify-content:center;
  padding: 22px 14px 36px;
  position:relative;
}

/* decorative border layer (weather-driven icons) */
.border-layer{
  position:fixed;
  inset: 10px;
  pointer-events:none;
  border-radius: 26px;
  border: 1px solid var(--line);
  box-shadow: 0 0 0 10px rgba(255,255,255,.22) inset, 0 0 0 1px rgba(255,255,255,.18) inset;
  overflow:hidden;
  z-index:0;
}
.border-layer::before{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(22px 22px at 18% 16%, var(--borderGlow), transparent 70%),
    radial-gradient(26px 26px at 86% 22%, var(--borderGlow), transparent 70%),
    radial-gradient(22px 22px at 78% 84%, var(--borderGlow), transparent 70%),
    radial-gradient(26px 26px at 14% 78%, var(--borderGlow), transparent 70%);
  opacity: .95;
  filter: blur(.2px);
}
.border-layer .weather-fx{
  position:absolute; inset:0;
  opacity: var(--borderOpacity);
}
.border-layer .weather-fx .fx{
  position:absolute;
  font-size: 26px;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.18));
  animation: floaty 7s ease-in-out infinite;
}
@keyframes floaty{
  0%,100%{ transform: translateY(0) translateX(0) rotate(0deg); opacity:.9}
  50%{ transform: translateY(-10px) translateX(6px) rotate(3deg); opacity:1}
}

.app{
  width:min(980px, 100%);
  position:relative;
  z-index:1;
}

/* ---------- Top nav ---------- */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  padding: 12px 14px;
  border-radius: 18px;
  background: var(--panel);
  border: 1px solid var(--line);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
}

.brand{
  display:flex;
  align-items:baseline;
  gap: 10px;
}
.brand h1{
  margin:0;
  font-size: 20px;
  letter-spacing:.5px;
}
.brand .sub{
  font-size: 12px;
  color: var(--muted);
}

.nav{
  display:flex;
  flex-wrap:wrap;
  gap: 8px;
  justify-content:flex-end;
}
.nav a{
  text-decoration:none;
  color: var(--ink);
  font-size: 13px;
  padding: 7px 10px;
  border-radius: 999px;
  border: 1px solid transparent;
  transition: transform .15s ease, background .15s ease, border-color .15s ease;
}
.nav a:hover{
  background: rgba(255,255,255,.55);
  border-color: var(--line);
  transform: translateY(-1px);
}
.nav a.active{
  background: rgba(255,255,255,.65);
  border-color: var(--line);
}

/* ---------- Theme switch ---------- */
.theme-switch{
  display:flex;
  gap: 6px;
  align-items:center;
}
.pill{
  display:flex;
  gap: 6px;
  padding: 6px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.55);
}
.theme-btn{
  border: 0;
  background: transparent;
  width: 34px;
  height: 34px;
  border-radius: 999px;
  cursor:pointer;
  font-size: 16px;
  transition: transform .15s ease, background .15s ease;
}
.theme-btn:hover{ transform: translateY(-1px); background: rgba(0,0,0,.04); }
.theme-btn[aria-pressed="true"]{ background: rgba(0,0,0,.06); }

/* ---------- Panels ---------- */
.grid{
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap: 14px;
  margin-top: 14px;
}
@media (max-width: 900px){
  .grid{ grid-template-columns: 1fr; }
}

.card{
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 14px 14px 12px;
  backdrop-filter: blur(10px);
}
.card h2{
  font-size: 14px;
  margin: 0 0 10px;
  letter-spacing:.2px;
}
.small{
  font-size: 12px;
  color: var(--muted);
}

/* ---------- Progress bars ---------- */
.progress-wrap{
  display:flex;
  flex-direction:column;
  gap: 10px;
}
.progress-line{
  display:flex;
  flex-direction:column;
  gap: 6px;
}
.progress-head{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap: 10px;
}
.progress-head .label{
  font-size: 13px;
}
.progress-head .value{
  font-size: 12px;
  color: var(--muted);
}

.bar{
  width: 100%;
  height: 14px;
  border-radius: 999px;
  background: rgba(0,0,0,.06);
  border: 1px solid var(--line);
  overflow:hidden;
}
.bar > i{
  display:block;
  height:100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--accent), rgba(255,255,255,.25));
  transition: width .6s ease;
}

/* ---------- Weather widget ---------- */
.weather{
  display:flex;
  align-items:center;
  gap: 12px;
}
.weather .icon{
  width: 46px;
  height: 46px;
  border-radius: 14px;
  display:grid;
  place-items:center;
  font-size: 26px;
  background: rgba(255,255,255,.55);
  border: 1px solid var(--line);
}
.weather .meta{
  display:flex;
  flex-direction:column;
  gap: 2px;
}
.weather .meta .place{
  font-size: 13px;
}
.weather .meta .desc{
  font-size: 12px;
  color: var(--muted);
}

/* ---------- Quote ---------- */
.quote{
  position:relative;
  padding-left: 12px;
  margin: 6px 0 0;
  font-size: 13px;
  line-height: 1.6;
}
.quote::before{
  content:"";
  position:absolute;
  left:0; top: 2px; bottom: 2px;
  width: 3px;
  border-radius: 99px;
  background: var(--accent);
  opacity:.65;
}

/* ---------- Summary list ---------- */
.kv{
  display:grid;
  grid-template-columns: 1fr;
  gap: 8px;
  margin-top: 6px;
}
.kv .row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  padding: 10px 10px;
  border-radius: 14px;
  border: 1px dashed rgba(0,0,0,.12);
  background: rgba(255,255,255,.45);
}
.kv .row .k{ font-size: 13px; }
.kv .row .v{ font-size: 12px; color: var(--muted); text-align:right; }

/* ---------- Countdown events ---------- */
.events{
  margin-top: 10px;
  display:flex;
  flex-direction:column;
  gap: 10px;
}
.events .form{
  display:grid;
  grid-template-columns: 1fr 160px 84px;
  gap: 8px;
}
@media (max-width: 640px){
  .events .form{ grid-template-columns: 1fr; }
}
input, textarea, select{
  font: inherit;
  padding: 10px 10px;
  border-radius: 14px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.62);
  outline: none;
}
textarea{ min-height: 92px; resize: vertical; }
button{
  font: inherit;
  cursor:pointer;
}
.btn{
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.62);
  transition: transform .12s ease, background .12s ease;
}
.btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.72); }
.btn.primary{
  background: linear-gradient(90deg, rgba(255,255,255,.72), rgba(255,255,255,.5));
  border-color: rgba(0,0,0,.12);
}
.btn.danger{ border-color: rgba(160,60,60,.25); }
.event-list{
  display:flex;
  flex-direction:column;
  gap: 8px;
}
.event-item{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 10px;
  padding: 10px 10px;
  border-radius: 16px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.45);
}
.event-item .left{
  display:flex;
  flex-direction:column;
  gap: 2px;
}
.event-item .title{ font-size: 13px; }
.event-item .meta{ font-size: 12px; color: var(--muted); }

/* ---------- Pomodoro ---------- */
.pomo{
  display:flex;
  flex-direction:column;
  gap: 10px;
}
.tomato{
  width: 132px;
  height: 132px;
  border-radius: 999px;
  margin: 6px auto 0;
  background:
    radial-gradient(70px 60px at 45% 40%, rgba(255,255,255,.35), transparent 60%),
    radial-gradient(110px 90px at 50% 55%, rgba(0,0,0,.08), transparent 66%),
    linear-gradient(180deg, rgba(255,255,255,.22), transparent 60%),
    #e36a5c;
  box-shadow: 0 14px 28px rgba(0,0,0,.14), inset 0 -14px 0 rgba(0,0,0,.12);
  position:relative;
  display:grid;
  place-items:center;
  user-select:none;
  cursor:pointer;
  transition: transform .14s ease;
}
.tomato:hover{ transform: translateY(-2px) scale(1.02); }
.tomato::before{
  content:"";
  position:absolute;
  top: -12px;
  left: 50%;
  width: 42px;
  height: 24px;
  transform: translateX(-50%);
  background: radial-gradient(18px 12px at 40% 80%, rgba(255,255,255,.35), transparent 70%),
              #4f7b65;
  border-radius: 0 0 16px 16px;
  box-shadow: 0 6px 12px rgba(0,0,0,.12);
}
.tomato .time{
  font-size: 22px;
  letter-spacing: .8px;
  color: rgba(255,255,255,.92);
  text-shadow: 0 2px 10px rgba(0,0,0,.18);
}
.pomo .hint{
  text-align:center;
  font-size: 12px;
  color: var(--muted);
}
.pomo .done{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap: 6px;
}
.pomo .done span{
  font-size: 18px;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.16));
}

/* ---------- Floating chat ---------- */
#chai-fab{
  position: fixed;
  right: 22px;
  bottom: 22px;
  width: 58px;
  height: 58px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.65);
  display:grid;
  place-items:center;
  cursor:pointer;
  box-shadow: var(--shadow);
  z-index: 20;
  user-select:none;
}
#chai-fab:hover{ transform: translateY(-1px); }

#chai-chat{
  position: fixed;
  right: 22px;
  bottom: 90px;
  width: min(360px, calc(100vw - 44px));
  height: 520px;
  border-radius: 22px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.78);
  box-shadow: var(--shadow);
  backdrop-filter: blur(12px);
  overflow:hidden;
  z-index: 25;
  display:none;
}
#chai-chat.open{ display:flex; flex-direction:column; }
#chai-chat .head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 10px 12px;
  border-bottom: 1px solid var(--line);
  background: rgba(255,255,255,.55);
}
#chai-chat .head .title{
  font-weight: 700;
  font-size: 13px;
}
#chai-chat .head .close{
  border:0;
  background: transparent;
  font-size: 18px;
  cursor:pointer;
  padding: 6px 10px;
  border-radius: 12px;
}
#chai-chat .head .close:hover{ background: rgba(0,0,0,.04); }

#chai-chat .log{
  flex:1;
  padding: 10px 10px 8px;
  overflow:auto;
}
.msg{
  max-width: 88%;
  padding: 9px 10px;
  border-radius: 16px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.62);
  margin: 8px 0;
  font-size: 13px;
  line-height: 1.55;
  white-space: pre-wrap;
  word-break: break-word;
}
.msg.me{
  margin-left:auto;
  background: rgba(215, 231, 208, .78);
}
.msg.bot{
  background: rgba(255,255,255,.62);
}
.msg .meta{
  font-size: 11px;
  color: var(--muted);
  margin-bottom: 4px;
}

#chai-chat .composer{
  display:flex;
  gap: 8px;
  padding: 10px;
  border-top: 1px solid var(--line);
  background: rgba(255,255,255,.55);
}
#chai-chat .composer input{
  flex:1;
  border-radius: 14px;
}
#chai-chat .composer button{
  width: 74px;
  border-radius: 14px;
}
#chai-chat .composer button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

/* ---------- Reading page ---------- */
.bookshelf{
  margin-top: 10px;
  display:flex;
  flex-direction:column;
  gap: 10px;
}
.shelf{
  border-radius: 18px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.42);
  padding: 10px 10px 12px;
}
.shelf .row{
  display:flex;
  gap: 8px;
  flex-wrap:nowrap;
  overflow:hidden;
  padding: 6px 2px;
  border-top: 1px dashed rgba(0,0,0,.12);
}
.shelf .row:first-child{ border-top: 0; }
.book{
  width: 52px;
  height: 86px;
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,.12);
  background:
    linear-gradient(180deg, rgba(255,255,255,.26), transparent 60%),
    rgba(111, 143, 114, .28);
  box-shadow: 0 10px 18px rgba(0,0,0,.08);
  cursor:pointer;
  position:relative;
  overflow:hidden;
  flex: 0 0 auto;
}
.book::after{
  content:"";
  position:absolute; inset:0;
  background: linear-gradient(90deg, rgba(255,255,255,.22), transparent 30%, rgba(0,0,0,.08));
  opacity:.7;
}
.book.has-cover{
  background-size: cover;
  background-position: center;
}
.book .spine{
  position:absolute;
  left: 6px;
  top: 8px;
  bottom: 8px;
  width: 8px;
  border-radius: 8px;
  background: rgba(0,0,0,.10);
}
.book .dot{
  position:absolute;
  right: 8px;
  top: 10px;
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: rgba(255,255,255,.65);
  border: 1px solid rgba(0,0,0,.10);
}

.cardlist{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}
@media (max-width: 900px){
  .cardlist{ grid-template-columns: 1fr; }
}
.bookcard{
  display:flex;
  gap: 10px;
  align-items:flex-start;
}
.bookcard .cover{
  width: 64px;
  height: 92px;
  border-radius: 14px;
  border: 1px solid var(--line);
  background: rgba(0,0,0,.06);
  background-size: cover;
  background-position: center;
  flex: 0 0 auto;
}
.bookcard .info{
  display:flex;
  flex-direction:column;
  gap: 4px;
}
.badges{
  display:flex;
  flex-wrap:wrap;
  gap: 6px;
}
.badge{
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.55);
  color: var(--muted);
}
.actions{
  display:flex;
  gap: 8px;
  margin-top: 8px;
}
.actions .btn{ padding: 8px 10px; }

.modal{
  position: fixed;
  inset:0;
  background: rgba(0,0,0,.35);
  display:none;
  align-items:center;
  justify-content:center;
  z-index: 30;
}
.modal.open{ display:flex; }
.modal .box{
  width: min(760px, calc(100vw - 28px));
  max-height: min(78vh, 720px);
  overflow:auto;
  border-radius: 22px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.82);
  backdrop-filter: blur(12px);
  box-shadow: var(--shadow);
  padding: 12px;
}
.modal .box .top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap: 10px;
  padding: 6px 6px 10px;
  border-bottom: 1px solid var(--line);
}
.modal .box .top .title{
  font-weight: 800;
  font-size: 14px;
}
.modal .box .top .x{
  border:0;
  background: transparent;
  font-size: 18px;
  cursor:pointer;
  padding: 6px 10px;
  border-radius: 12px;
}
.modal .box .top .x:hover{ background: rgba(0,0,0,.04); }
.modal .box .content{
  padding: 10px 8px 6px;
  display:grid;
  grid-template-columns: 170px 1fr;
  gap: 12px;
}
@media (max-width: 700px){
  .modal .box .content{ grid-template-columns: 1fr; }
}
.modal .cover{
  width: 170px;
  height: 240px;
  border-radius: 18px;
  border: 1px solid var(--line);
  background: rgba(0,0,0,.06);
  background-size: cover;
  background-position: center;
}
.modal .content .text{
  display:flex;
  flex-direction:column;
  gap: 8px;
}
hr.sep{ border:0; border-top: 1px dashed rgba(0,0,0,.14); margin: 8px 0; }

/* ---------- Simple pages ---------- */
.simple-grid{
  display:grid;
  grid-template-columns: 1fr;
  gap: 12px;
  margin-top: 14px;
}
.list{
  display:flex;
  flex-direction:column;
  gap: 8px;
}
.item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  padding: 10px;
  border-radius: 16px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.45);
}
.item .left{ display:flex; flex-direction:column; gap:2px;}
.item .left .t{ font-size: 13px; }
.item .left .m{ font-size: 12px; color: var(--muted); }
